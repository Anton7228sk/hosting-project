services:
  # 1. Traefik - –ì–ª–∞–≤–Ω—ã–π —à–ª—é–∑ (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π HTTPS)
  traefik:
    image: traefik:v2.10
    container_name: traefik_proxy
    command:
      # --- –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ---
      - "--api.insecure=true"
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      
      # --- 1. –í–•–û–î–ù–´–ï –¢–û–ß–ö–ò (PORTS) ---
      - "--entrypoints.web.address=:80"     # HTTP
      - "--entrypoints.websecure.address=:443" # HTTPS
      
      # --- 2. –ù–ê–°–¢–†–û–ô–ö–ê LET'S ENCRYPT ---
      - "--certificatesresolvers.le.acme.email=shkrebela.a@gmail.com" # <--- –£–ö–ê–ñ–ò –°–í–û–ô EMAIL
      - "--certificatesresolvers.le.acme.storage=/letsencrypt/acme.json"
      - "--certificatesresolvers.le.acme.tlschallenge=true" 
      
      # --- 3. –†–ï–î–ò–†–ï–ö–¢ HTTP –ù–ê HTTPS ---
      - "--entrypoints.web.http.redirections.entrypoint.to=websecure"
      - "--entrypoints.web.http.redirections.entrypoint.scheme=https"
      
    ports:
      - "80:80"
      - "443:443" # –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç 443
      - "8080:8080"
      
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ./letsencrypt:/letsencrypt # –ü–∞–ø–∫–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ Traefik

      
    networks:
      - hosting_net

  # 2. –í–∞—à–∞ –ü–∞–Ω–µ–ª—å –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è
  web_panel:
    build: .
    container_name: hosting_panel
    restart: always
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./user_data:/app/user_data
      - ./hosting.db:/app/hosting.db
    ports:
      - "5000:5000"
    networks:
      - hosting_net
    # üëá –¢–ï–ü–ï–†–¨ –°–ï–ö–¶–ò–Ø ENVIRONMENT –° –ü–†–ê–í–ò–õ–¨–ù–´–ú –û–¢–°–¢–£–ü–û–ú
    environment:
      - REAL_PROJECT_PATH=${PWD}

networks:
  hosting_net:
    name: hosting_net